{% extends 'base.html' %}

{% block title %}Profilo{% endblock %}

{% block styles%}
<link rel="stylesheet" href="{{url_for('static', filename='css/home.css')}}">
<link rel="stylesheet" href="{{url_for('static', filename='css/profile.css')}}">

{% endblock %}

{% block main %}

    <div class="profilePage d-flex flex-column align-items-start justify-content-start">
        <div class="welcome d-flex flex-column align-items-start justify-content-start">
            <h4>Welcome, </h4>
            <h1>{{current_user.name}}</h1>
        </div>

       {% if type == 'partecipante' %}
            {% if ticket_info == 'none' %}
                <div class="buyTicket d-flex flex-column">
                    <h5>Non hai ancora acquistato un biglietto!</h5>
                    <button class="btn btn-outline-success" onclick="window.location.href = '/tickets'">Acquista ora</button>
                </div>
            {% else %}

                <div class="infoTicket">
                    <h1>Look at your ticket information:</h1>
                <svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000" class="ticket-bg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier"> <style type="text/css"> .st0{fill:#000000;} </style> 
                        <g> <path class="st0" d="M504.24,170.048c-14.848-0.008-28.216-6-37.953-15.728c-9.728-9.736-15.72-23.112-15.72-37.96v-7.752H61.44 v7.752c-0.008,14.848-5.992,28.224-15.72,37.96c-9.744,9.728-23.112,15.72-37.96,15.728H0V341.96h7.76 c14.848,0,28.216,5.992,37.96,15.72c9.728,9.736,15.712,23.105,15.72,37.953v7.76h389.128v-7.76 c0-14.848,5.992-28.216,15.72-37.953c9.736-9.728,23.105-15.72,37.953-15.72H512v-7.76V170.048H504.24z M496.488,326.912 c-32.016,3.568-57.4,28.952-60.976,60.968H76.496c-3.584-32.016-28.968-57.4-60.984-60.968V185.104 c32.016-3.584,57.4-28.968,60.984-60.984h359.016c3.576,32.016,28.96,57.4,60.976,60.984V326.912z"></path> 
                            <rect x="120.68" y="139.552" class="st0" width="15.512" height="42.928"></rect> 
                            <rect x="120.68" y="202.824" class="st0" width="15.512" height="42.92"></rect> 
                            <rect x="120.68" y="266.088" class="st0" width="15.512" height="42.928"></rect> 
                            <rect x="120.68" y="329.352" class="st0" width="15.512" height="42.928"></rect> 
                        </g> 
                    </g>
                </svg>

                <div class="infoElement">
                    <h3 class="staatliches-regular">{{ ticket_info['ticketType'] }}</h5>
                    {% if ticket_info['secondDay'] == None %}
                    <div class="lineTicket">
                        <p class="staatliches-regular">For</p>
                        <p class="lexend-500">{{ ticket_info['firstDay'] }}</p>
                    </div>
                    {% else %}
                    <div class="lineTicket">
                        <p class="staatliches-regular">From</p>
                        <p class="lexend-500">{{ ticket_info['firstDay'] }}</p>
                    </div>
                    <div class="lineTicket">

                        <p class="staatliches-regular">To</p>
                        {% if ticket_info['thirdDay'] %}
                            <p class="lexend-500">{{ ticket_info['thirdDay'] }}</p>
                        {% else %}
                            <p class="lexend-500">{{ ticket_info['secondDay'] }}</p>
                        {% endif %}
                    </div>
                    {% endif %}


                </div>

                </div>
            {% endif %}
        {% else %}
            {% if e_performances == 'No performances' %}
                <div class="noPerformances">
                    <h1>No drafts found</h1>
                </div>
            {% else %}
                <div class="editablePerformances">
                    <h1></h1>

                    <section class="upcomingPerformances">
                        <h2 class="lexend-500">Your Setlist</h2>
                        <h5 class="lexend-500">Review your setlist before going live</h5>
                            <ul class="listPerformances" id="listPerformances">

                                {% for p in e_performances %}
                                    <li class="draftPerformance">
                                        <div class="artistName">                    
                                            <h4 class="lexend-500">{{p['artist']}}</h4>
                                        </div>
                                        <div class="actions">
                                            <input hidden value="{{p['id']}}" id="{{p['id']}}">
                                            <p class="lexend-500 edit" data-bs-toggle="modal"
                                                data-bs-target="#editPerformance"
                                                onclick="findPerformance(document.getElementById('{{p.id}}').value)">Edit</p>
                                            <p class="lexend-500 delete"
                                            data-bs-toggle="modal"
                                            data-bs-target="#deleteAdvise">Delete</p>
                                        </div>
                                    </li>

                                <!-- Modal avviso delete -->
                                    <div class="modal fade" id="deleteAdvise" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title staatliches-regular fs-5" id="exampleModalLabel">Delete performance</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <h2 class="staatliches-regular">Are you sure you want to delete this Draft?</h2>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-warning" onclick="deleteDraft(document.getElementById('{{p.id}}').value)">Delete</button>
                                        </div>
                                        </div>
                                    </div>
                                            </div>
                                {% endfor %}
                            </ul>
                    </section>


     



                    <!--Modale per modificare la bozza-->

                    <div class="modal fade" id="editPerformance" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title staatliches-regular fs-5" id="staticBackdropLabel">Modal title</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="resetModal()"></button>
                        </div>
                        <div class="modal-body" id="performanceElements">
                            <form class="updatePerformance" method="POST" id="editPerformance" action="/updatePerformance" enctype="multipart/form-data">
                                <label for="artist" class="customLabel form-label staatliches-regular">Artist name</label>
                                <input class="custom-form form-control" type="text" name="artist" id="artist" placeholder="Miles Davis" required minlength="3" maxlength="30">
                                
                                <input id="id" name="id" hidden>

                                <label for="day" class="customLabel form-label staatliches-regular">Select day</label>
                                <select class="custom-select form-select" name="day" id="day">
                                    <option value="friday">Friday</option>
                                    <option value="saturday">Saturday</option>
                                    <option value="sunday">Sunday</option>
                                </select>
 
                                <label for="start" class="customLabel form-label staatliches-regular">
                                    Modifica orario di inizio
                                </label>
                                <input type="text" class="custom-form form-control" id="start" name="start" pattern="^[0-9]{2}:[0-9]{2}$" title="inserire un formato orario valido: hh:mm">

                                <label for="duration" class="customLabel form-label staatliches-regular">Approximate duration (minutes)</label>
                                <input type="number" class="custom-form form-control" id="duration" name="duration" required min="10" max="120" pattern="\b\d{2,3}\b">

                                <label for="stage" class="customLabel form-label staatliches-regular">Select Stage</label>
                                <select class="custom-select form-select" name="stage" id="stage">
                                    <option selected value="A">
                                        Stage A
                                    </option>
                                    <option value="B">Stage B</option>
                                    <option value="C">Stage C</option>


                                </select>

                                <label for="description" class="customLabel form-label staatliches-regular">Description</label>
                                <input name="description" id="description" class="custom-form form-control" required minlength="10" maxlength="100">

                                <label for="genre" class="customLabel form-label staatliches-regular">Genre</label>
                                <input type="text" id="genre" name="genre" class="custom-form form-control" required minlength="3" maxlength="20">

                                <div class="image" id="image" value="">

                                    <div class="dropdown dropstart">
                                        <button class="btn btn-outline-primary" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                                                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                                            </svg>
                                        </button>
                                        <ul class="custom-select dropdown-menu">
                                            <li><a class="dropdown-item" id="visualizza"  href="#" target="_blank">See image</a></li>
                                            <li><a class="dropdown-item" id="elimina" onclick="triggerNewFile()">delete image</a></li>                                        
                                        </ul>
                                    </div>


                                </div>

                                <div  class="newFile" id="newFile">
                                    <label for="file" class="customLabel form-label staatliches-regular">Insert image</label>
                                    <input type="file" name="file" id="file" class="custom-form form-control" placeholder="insert image">

                                </div>

                                <div class="d-flex flex-row">




                                    <input type="hidden" id="type_post" name="type_post" value="">
                                    <button type="submit" style="display: none;" id="submit"></button>

                                </div>



                            </form>
                        </div>
                        
                        <div class="modal-footer">
                            <div class="btn btn-outline-primary"
                                onclick="document.getElementById('type_post').value = 'bozza'; document.getElementById('submit').click()">Salva come bozza</div>

                            <div class="btn btn-outline-success"
                               onclick="document.getElementById('type_post').value = 'pubblicato'; document.getElementById('submit').click()">Posta ora</div>
                        </div>
                        </div>
                    </div>
                    </div>



                </div>
            {% endif %}
                <section class="upcomingPerformances">
                    <h2 class="lexend-500">Saved performances</h2>
                        <ul class="listPerformances" id="listPerformances">

                            {% for p in a_performances %}
                                <li class="singlePerformance" onclick="window.location.href = '/details/{{ p.id }}'">
                                    <div class="artistName">                    
                                        <h4 class="lexend-500">{{p['artist']}}</h4>
                                    </div>

                                    <div class="dateInfo dayPart">
                                        <p class="lexend-500">{{p['day']}}</p>
                                    </div>

                                    <div class="dateInfo">
                                        <p class="lexend-500">{{p['start']}}</p>
                                    </div>

                                    <div class="dateInfo stagePart">
                                        <p class="lexend-500">Stage {{p['stage']}}</p>
                                    </div>

                                </li>
                            {% endfor %}
                        </ul>
                </section>

                <section class="ticketStats">
                    <h2 class="lexend-500">Ticket statistics</h2>

                    <svg viewBox="0 0 100 115" xmlns="http://www.w3.org/2000/svg">
                        <rect x="10" y="60" width="20" height="40" fill="#F24B4B" id="fridayRect">
                            <title>Friday</title>
                        </rect>
                        <rect x="40" y="30" width="20" height="70" fill="#F24B4B" id="saturdayRect" />
                        <rect x="70" y="45" width="20" height="70" fill="#F24B4B" id="sundayRect" />
                        
                        <line x1="0" y1="100" x2="100" y2="100" stroke="black" />
                        <line x1="7" y1="100" x2="7" y2="0" stroke="black" stroke-width="1px" />
                        
                        <text x="0" y="50" font-size="3" fill="black" dominant-baseline="hanging">100</text>

                        <text x="0" y="0" font-size="3" fill="black" dominant-baseline="hanging">200</text>
                        <text x="15" y="105" font-size="3" fill="black" dominant-baseline="hanging">Friday</text>
                        <text x="43" y="105" font-size="3" fill="black" dominant-baseline="hanging">Saturday</text>
                        <text x="75" y="105" font-size="3" fill="black" dominant-baseline="hanging">Sunday</text>



                    </svg>



                </section>

        {% endif %}





    </div>
    





{% endblock %}

{% block scripts%}
    <script src="{{url_for('static', filename='profile.js')}}"></script>
{% endblock %}